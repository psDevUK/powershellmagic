[[{"l":"Powershell Magic"},{"l":"Been on my mind","p":["So it has been on my mind \uD83D\uDCAD for quite sometime to build a new website, however I just never got round to it. So tonight whilst walking my dogs \uD83D\uDC15 with the mrs, I got saying how I feel the need to do a super amazing Powershell website \uD83D\uDCAF but just did not feel my mojo \uD83E\uDDE0 was in the right place. My mrs was like:","Just get on and do it, you always over think things"]},{"l":"More thinking","p":["This then led me to think \uD83D\uDCAD well I done a module for retype a while back this should be easy. Sadly seems that module is not working how it used to work since publishing it \uD83D\uDE22. Which got me thinking about how I should have put workflows into all my modules to make them easier to update. Like people say 'hindsight is a great thing' so as my plan A to build this site fell flat on it's face, I decided to go back to the source aka the official site for this great easy to use web designer. The Official Retype Site"]},{"l":"Reading research","p":["As I am that bit older now \uD83D\uDC74 I did further reading of the documentation, and when logging into the hosting site I use to publish personal websites,I discovered I had the same idea six months ago \uD83D\uDCC6 as I had setup this powershell magic domain, \uD83C\uDF0E but obviously the magic stopped there as never got round to publishing it. Having used Azure DevOps for nearly three years now with CI/CD pipelines to commit the work I do on the automation repository and raise a change notification for the change team, I thought this time round I would add in a github workflow to auto publish this site from my associated github repository. This should allow me to knock more pages together in shorter time and hopefully keep you the audience like your favourite TV \uD83D\uDCFA show or comic just hanging to see the next episode, or reading the next title to be published.","Yes I am still reading comics \uD83E\uDDB8 so lets do what I did before and add some lovely pictures and get talking Powershell. This as it says on the picture is The Magic Order and is a totally epic comic written by Mark Millar, currently there is five series of this out, and will hopefully come to Netflix soon."]},{"l":"Previous Powershell blog","p":["My previous blog site (link at the top of the page) led to some amazing things for me, it helped me secure a job, it got me invited to do some Powershell talks to live human beings who attended. I also got to go on the Powershell podcast, I even got a call from Jason Helmick from the official Powershell Microsoft team. I also got to speak to a huge idol of mine Chrissy LeMaire who is like the most awesome person I know (apart from my mrs that is) and life was going great. Sadly I had some personal issues and then basically went and hid in a cave all this time being a hermet \uD83D\uDC1A. I have just been so focused on my job and wanting to give 100% each day that I neglected the blogging that I was really enjoying doing. I stupidly \uD83E\uDD21 also turned down book offers to author a Powershell book from several different publishers (major regret \uD83D\uDE2D) just because I wanted to be 100% focused on my job, and to provide for my family."]},{"l":"New location","p":["Just under a year ago I moved \uD83C\uDFE0 house to a more remote location in the UK, which to be honest feels like I am on holiday everyday as the surroundings are so beautiful, and only a few minutes from the sea. I find the ocean \uD83C\uDF0A so therapeutic to listen and look at the big waves crashing in, I go to the beach everyday to get my fix of mother nature \uD83C\uDFD6️. Then just as I am like I finally done it, life is feeling really good, I get informed that my work wanted to do mass redundancies in IT due to the merger that was done with another company. Despite numerous people telling me I am safe because I am the only person who does x, y and z at work sadly that does not seem to be the case and I felt like this lady at the front of this comic when having the consultation that I was not coming out of this without damage being done:","I so miss my old boss I used to work for in the same company, he was a complete legend and had my back, however the boss I have now is the complete opposite and certainly does not have my back. Else I do not feel I would now be in an uncertain position in life, which I am now faced with, which seems like 90% of LinkedIn members are also in, as in looking for a new position to work in."]},{"l":"Looking for work","p":["However, after notifiying the WWW I am now open for work, this led to a number of Microsoft MVPs to recommend me and re-share my post which really was moving \uD83D\uDC96 as I have not been on social media for time ⏱️ and I am not an MVP myself so to get so much positive feedback from various LinkedIn members and especially Microsoft MVPs also inspired me to get a new website together and show why you should be hiring me."]},{"l":"You made it this far","p":["If you survived reading this landing page congratulations, trust the rest of this site is not about my life dilemmas and will feature lots of \uD83D\uDE0E awesome Powershellness that should leave you feeling \uD83E\uDD2F refreshed. Until the next page comes out, thanks for visiting and hang tight and the code will be coming in the next update."]},{"l":"Something to share","p":["I can however share with you my latest youtube video I made, working on some oldskool house vibes if you like this video the by all means feel free to subscribe as I have been trying to make my own music for a little while now \uD83C\uDFB5"]}],[{"l":"Powershell Magic","p":["As promised in the landing page this time we are actually going to do some powershell magic which to me is being able to provide a script from scratch to deliver the solution to the given problem."]},{"l":"Thinking...","p":["I firmly believe in understanding and thinking of how you will provide a solution to the given problem, and to also have a back-out plan in-place if any changes are being involved. I do not influence violence by any means as the solution, but as the picture above shows, this lady has thought her way out of the problem she was presented with."]},{"l":"Normal rules I follow","p":["Understand the problem\uD83D\uDE15 if you do not understand the problem ask for it t be explained again. Then look to apply a solution which can be re-used to fix the given problem. Normally this involves writing a function and providing certain criteria as parameters, so that you can then change the values of those parameters to meet the given problem you are trying to fix.","Do not re-invent the wheel\uD83C\uDFA1 as in you could potentially go off on a mission to re-create something out there that already exists. So I strongly advise you at least check out the Powershell gallery for any existing modules that may already exist to help you solve the scripting quest you have been presented with. You could also use code specific sites such as GitHub to see if something exists or something to inspire you. Yes at school you may have got yourself into big trouble as this is technically plagiarism but we are not at school anymore.","Do not spend too long looking for something else⏰ to solve the problem for you, as in if you could do the task manually in ten minutes but you spend three hours looking for that solution, then to me that is not time well spent and being efficient. I tend to limit my time reasearching to a maximum of twenty minutes, as I knew this particular task would have taken a lot longer doing this manually, so even if I did not find any modules or scripts of interest I have only invested a maximum of twenty minutes of my time.","Get cooking up a solution\uD83C\uDF73 as in start coding the solution to the problem, I like to add comments so that if someone else should need the code, or you show it to someone who does not fully understand code, they should be able to understand the comments you have made and read through those understanding what your script is going to do and the order it is doing it in."]},{"l":"What was the problem?","p":["Hopefully as the link suggested the issue was numerous zero-day threats discovered from an article my boss had read Security Article My boss wanted me to verify that each of those zero-day threats we had protection against in SCCM. Although SCCM is amazing in deploying various items across you network, I do find it extremely point and clicky and sometimes over-kill to get the information you are after. So I knew about the Configuration Manager module, as I have used it to build my own stream-lined SCCM dashbaord. However how could I get all the CVE information from the website I was provided a link to and then double check that the fix had been setup in SCCM?","This is where you use twenty minutes of your time wisely, which led me to a module I had never heard of or used before MSRCSECURITYUPDATES","Using this module, I could reference any given CVE threat, then obtain the KB article number which has been released to fix that specific CVE threat. This would save me a lot of time from trying to obtain this off of the internet visiting numerous websites for each CVE, and again save me a lot of point and clicking. \uD83D\uDC01"]},{"l":"What was your solution?","p":["Although I did mention functions in my previous normal rules I follow, as this was the first time of being asked to provide this type of information in the two years and eleven months I have worked at this company, this did more seem like a one-off request. I normally write the script, then if I see that the script could be useful say to check this on numerous computers, and other filters, then yes I would most certainly make this into a function so that you do not have to manually edit the script each time. As this was a one-off request then I decided producing a script to provide the answer of yes the patch is in SCCM and has been deployed or no these CVEs are not currently protected against in SCCM was a good enough solid answer to the problem I was provided with."]},{"l":"The end solution"},{"l":"Thank you","p":["Again thanks for your time reading this article and hopefully this has given you some ideas \uD83D\uDCA1 in your head on fixing a similar issue you may have been presented with at work, or just little tips used to be more effective in providing a scripted solution to any given problem. In total this took less than an hour to produce from the initial question being asked, and I was certain that the information returned was correct. Thankfully all patches did exist in SCCM and that was that."]},{"l":"Something to share","p":["Recent times have been pretty emotional for me, especially with more recent news. I do find music can help, and even better if you can put a tune together to show how you are feeling. so I hope you enjoy this emotion tune I made \uD83C\uDFB5","Until next time, stay safe and see you again soon for another Powershell solution \uD83D\uDE01"]}],[{"l":"Powershell Magic","p":["Hello folks, yes this blog is a few days later than planned, and well there is a good reason for that. Unfortunately I was really sick \uD83E\uDD2E all this weekend, but prior to that my wife had it Thursday night, then my youngest daughter, then my eldest daughter, then second eldest, then my third youngest daughter, then my second youngest daughter then I finally got it. So was a very unpleasant twenty hours of that happening. Guess when you got a family my size and one of you gets ill then you are all bound to get it."]},{"l":"Not feeling well","p":["Top Tip: Wearing a mask whilst puking your guts up is not a good idea.","Moving on swiftly let us talk about some more Powershell magic in applying a fix to the problem."]},{"l":"What was the problem?","p":["So the issue we are going to discuss is duplicate assets in Tenable. I know at first you may think well that has nothing to do with Powershell, and you are correct. However I provided a solution using Powershell and the Tenable APIs to solve the given issue. Yes this is a problem that seems to have been talked about for years on the internet, but after spending time to look into the issue to see if there was a magic \uD83E\uDDD9 hotfix, or patch to apply to Tenable to resolve the issue and finding one did not exist. Then looking on various forums and seeing other Tenable customers were also suffering from this same issue, but no definitive resolution on how they solved it.","Example of this problem","I did find that someone had set a particular registry entry to read-only which then meant Tenable had to use the next criteria to check if the machine is unique. This did make sense in my opinion but I had been informed that, that method had already been tried and did not work."]},{"l":"Contact the vendor","p":["I wanted a proper Tenable solution to this, so I raised the support call with Tenable ☎️ who could confirm that the scanning to test if an asset was unique or not was done in this particular order (most useful information I was provided with):","Tenable UUID","BIOS UUID","MAC Address","NetBIOS Name","Fully Qualified Domain Name (FQDN)","IPv4 Address","As the first option is checking the registry again that made sense to set that as read-only to force Tenable to try the next object in the list. Once again I was denied.","Although I had supplied numerous proof to Tenable that these duplicate assets existed, they wanted access and the passwords to look at the database. I asked for this information but as I was not supplied it from the securty team Tenable closed the call after 7 days of no reply.","It did seem a bit \uD83D\uDD29 nuts that Tenable could not supply a fix to a problem that has existed for at least five years, and just ask for access to your databases, instead of maybe providing checks to do in the database. Or checking specific scan settings, but sometimes it is what it is. Providing not so awesome support to paying customers"]},{"l":"Plan B","p":["So although plan A did not go as planned, as in I was hoping the vendor would supply a permanent fix to the issue. I still had this issue with numerous duplicate assets in Tenable which I was also sure was affecting the CES Cyber Exposure Score by making this inflated as it was counting all the duplicates as unique assets, so any threats these duplicate assets had were being shown numerous times. \uD83E\uDDEE","I had spent time \uD83D\uDD57 looking at a solution on the WWW and found only a potential solution to fix the issue, which I was not allowed to try as apparently it had already been tried. I had reached out directly to the vendor expecting some patch or specific setting which could be changed, but again the support I received, did not provide any information to solve this \uD83D\uDE22 and you are still expected to fix the issue, seeming as you were the one who identified it.","I am not to good at planning things in a diagram format, but this was the plan in my head. So my idea was grab all the assets that are in Tenable, dump them to a CSV file, then use a parameter to seach for particular naming conventions, group all those assets, sort them by descending order and skip the first result.\uD83E\uDD2F Then all that are left in the group are duplicate assets that were not the most recently seen, meaning it was a stale duplicate record. Provide your own solution to a problem, making sure it works"]},{"l":"Research","p":["Despite the support I received from Tenable not being the best, as no answer could be provided, just more questions being asked to me. Tenable does have decent documentation on their API and how to use it:","Tenable API documentation","There is quite a bit of information displayed here, due to there being a lot you can do in Tenable, and this provides the API way of doing each of those things. As hopefully you realise that I am not a \uD83D\uDC2D point and click type of guy.","After looking at this documentation \uD83E\uDD71 I saw there was a method for exporting all the assets, and that is all I really needed as my idea I explained earlier would dump this information into a CSV as a lookup table for particular assets."]},{"l":"Time to get cooking","p":["\uD83D\uDC68‍\uD83C\uDF73 Unlike my previous post I wrote about, I knew from the get-go that I would most certainly be using this solution more than once to fix this issue, as sadly Tenable could never provide an answer to the problem. As I know it was going to be used more than once, this to me made it worth while into making this into a function. Maybe even two functions, one to gather all the Tenable assets, then another to find the duplicates.","The above function will gather all the assets registered in Tenable and place them into a CSV. I know I am missing a help section I promise to do better on my next post, but as I was not publishing this anywhere, and I was going to be the one running it, I thought I should remember something like Get-TenableAssets -OutputCSV C:\\Temp\\TenableAssets.csv yes I know I could have used a more standard parameter like path or something similar, but I decided that OutputCSV was good enough for the job. This was my function after all. The more assets you have the longer this function will take to run.","Now I needed another function to actually sort the duplicates from the CSV file. Yes I know excel has this built-in to highlight duplicate values, but you would still then need to extract the UUID of the asset to delete, and I did not want to delete all duplicates, as I wanted to keep the one unique one, which would be the most recently seen by Tenable."]},{"l":"Solution","p":["By extracting all the Tenable assets with Get-TenableAssets function which I only needed to run once. Then I could use the second function Get-DuplicateTenableAssets to search for various naming conventions that I knew duplicates fell under. Although I did not lower the CES as much as I might have hoped, this did go down by at least 15 points. If you work with Tenable you may also know that say fixing 500+ assets with a problem, might only lower the CES score by 1 point. When I looked at it like that it did make me feel a bit better, and also proved to the doubters in the security team that the duplicate assets were indeed inflating the CES within Tenable. \uD83D\uDCA5"]},{"l":"Something to share","p":["Yes it is more music I want to share that I put together. I am sure that if you work in IT you most likely played arcade games or oldskool console games when you were younger. So please enjoy this chiptune inspired music I put together \uD83C\uDFB5"]}],[{"l":"Powershell Magic"},{"l":"Welcome Back","p":["Today we will cover another tale from the depths of the IT world on how Powershell can save your \uD83E\uDD53 when being tasked with a problem to solve. To me the main problem is, the \uD83D\uDC2D and a crazy amount of sysadmins out there prefer to use this \uD83D\uDC2D to point and click there way through any issue. I think some people must see it as their sword to fight off all the problems swaying it about all day and using a lot of the working day using this \uD83D\uDC2D of theirs to click there way through any given problem.","Do not worry people I have my mighty point and click mouse to save the day","People the year is not 1995 anymore, it is 2025 and to me the \uD83D\uDC2D is just a big drain on the time it takes to fix the problem. Plus leading to possible errors clicking on the wrong item or object and then leading to more delays or possible issues. Then with the amount of servers some people look after, like myself this number is a bit under 3,000 then to say fix even 200 of this number with a specific fix taking the point and click route is just going to take forever."]},{"l":"Microsoft Windows Unquoted Service Path Enumeration","p":["I will be looking at a particular threat that exists out in the wild-west of Windows and how using a bit of \uD83E\uDDE0 power and the mighty Powershell to resolve this issue in a flash. More information on this threat can be found right here:","Nessus Plugin ID 63155","Again what I do not understand is for a paid for product like Tenable they do provide you with a solution for most of the issues, but the solution is like so half-assed in my opinion just like this particular issue we are focusing on today. Like if this only affects Windows boxes, and requires the same fix to be applied as in placing quotes around the service path which contains spaces, then why the heck does Tenable not provide a Powershell solution to the problem? As all Windows boxes these days run Powershell, and even if your company is still running on 2008 servers or something crazy like that, you can still use Powershell.","The only benefit of the paid for version of Tenable is that it will identify the service at fault, allowing you to specifically go to that particular area. I do not know how much Tenable costs, but it does seem bonkers that a massive anti-threat provider cannot provide the solution to make things easier for sysadmins out there who might not be able to write their own non-point-and-click solution to the given problem."]},{"l":"Break it down","p":["No I do not mean perform run DMC dance-off moves I mean lets break this problem down.","It affects Windows machines","It is related to a service having spaces in the path","It will always be in the same registry location","Armed with this information and a little bit of thinking, this seems a perfect time to cook up a delicious script to fix the issue. So I might have only 20 machines to fix, but setting up remote desktop to each of those machines, then logging on, then opening the registry, then navigating to the specific registry area, then tracking down the exact service which needs quotes around it, all seems way over-kill. Especially if it really affects say 200 machines now your looking at spending possibly days doing the same mind-numbing point and click routine. Not good use of your skils or \uD83E\uDDE0 power.","A bit like riding a super-powered bike, whilst scraping a ninja sword along the ground. Total over-kill except this looks super-cool over-kill, you pointing a clicking your mouse will never look this cool"]},{"l":"My Solution","p":["So for a long-time Powershell has supported the Invoke-Command cmdlet to make life less point and clicky, by allowing you to run commands against remote computers. However this does rely on you having certain 'things' configured for this to happen correctly, one of these being that port 5985 is accessible on the remote machine from the machine you are running these commands.","I also built my own Tenable dashboard, to make it easy to find all machines with a particular pluginid threat, and the ability to the export those machines to a CSV from the mighty Powershell Universal which is an AMAZING product. So I visit my dashboard I type in the plugin id for this problem which then gives me all the affected machines. I then export that list to a CSV so I have an array of machine names to apply this given solution to.","Going to use a handy function I use in a lot of my scripts when running commands remotely against remote machines to make sure the machine has the port 5985 open before trying to invoke-command as again this can slow down your script considerably waiting for this to time out, when you could just do a simple check prior to make sure that the required port is open to allow remoting.","The script starts off defining this handy function Test-Port which will then load it into memory to allow you to use it throughout that powershell session you are running.","Next I am defining the array of Windows machines this fix needs to be applied to which was gained through Tenable.","As the exact same thing needs to be done on each machine although the service name may vary I took the approach of using a regular expression with the knowledge that the services in question are running off of the C: drive. This allowed the solution to not rely on me having to specify a specific path, and use a more one-size-fits-all approach to the method.","Any unquoted services found, will then have the needed speech quotes put around them. \uD83D\uDCA5","Mission Accomplished\uD83D\uDE0E"]},{"l":"Thank you","p":["Thanks for taking the time to read this blog, and if you work for Tenable and you need someone to provide easy-to-use solutions to the vulnerabilities your software exposes then please get in touch as looking for new job opportunities. On that note, will leave you with some chilled out music I made a little while back."]}]]