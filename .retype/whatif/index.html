<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="3.11.0.812058570042">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 3.11.0">

    <!-- Primary Meta Tags -->
    <title>Powershell Magic </title>
    <meta name="title" content="Powershell Magic ">
    <meta name="description" content="Powershell is your best friend for automation in my opinion">

    <!-- Canonical -->
    <link rel="canonical" href="https://powershellmagic.netlify.app/whatif/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://powershellmagic.netlify.app/whatif/">
    <meta property="og:title" content="Powershell Magic ">
    <meta property="og:description" content="Powershell is your best friend for automation in my opinion">
    <meta property="og:image" content="https://powershellmagic.netlify.app/images/ps.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://powershellmagic.netlify.app/whatif/">
    <meta property="twitter:title" content="Powershell Magic ">
    <meta property="twitter:description" content="Powershell is your best friend for automation in my opinion">
    <meta property="twitter:image" content="https://powershellmagic.netlify.app/images/ps.png">

    <script data-cfasync="false">(function(){var cl=document.documentElement.classList,ls=localStorage.getItem("retype_scheme"),hd=cl.contains("dark"),hl=cl.contains("light"),wm=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;if(ls==="dark"||(!ls&&wm&&!hd&&!hl)){cl.remove("light");cl.add("dark")}else if(ls==="light"||(!ls&&!wm&&!hd&&!hl)){cl.remove("dark");cl.add("light")}})();</script>

    <link href="../logo.png" rel="icon">
    <link href="../resources/css/retype.css?v=3.11.0.812058570042" rel="stylesheet">

    <script data-cfasync="false" src="../resources/js/config.js?v=3.11.0.812058570042" data-turbo-eval="false" defer></script>
    <script data-cfasync="false" src="../resources/js/retype.js?v=3.11.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" data-cfasync="false" src="../resources/js/lunr.js?v=3.11.0.812058570042" data-turbo-eval="false" defer></script>
    <script id="prism-js" data-cfasync="false" src="../resources/js/prism.js?v=3.11.0.812058570042" defer></script>
</head>
<body>
    <div id="retype-app" class="relative text-base antialiased text-base-text bg-base-bg font-body">
        <div class="absolute bottom-0 left-0" style="top: 5rem; right: 50%"></div>
    
        <header id="retype-header" class="sticky top-0 z-30 flex w-full h-16 bg-header-bg border-b border-header-border md:h-20">
            <div class="container relative flex items-center justify-between pr-6 grow md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton retype-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="retype-sidebar-left-toggle-button"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="retype-branding-logo" href="../" class="flex items-center leading-snug text-xl">
                            <span class="w-10 mr-2 grow-0 shrink-0 overflow-hidden">
                                <img class="max-h-10 dark:hidden md:inline-block" src="../logo.png">
                                <img class="max-h-10 hidden dark:inline-block" src="../logodark.png">
                            </span>
                            <span class="dark:text-white font-bold line-clamp-1 md:line-clamp-2">Automation Ideas</span>
                        </a>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block border-base-border"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav id="retype-header-nav" class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://adam-bacon.netlify.app/">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/>
                                        </g>
                                    </svg>
                                    <span>Old Blog Site</span>
                                </a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
                            <input class="w-full h-10 placeholder-search-placeholder transition-colors duration-200 ease-in bg-search-bg border border-transparent rounded md:text-sm hover:border-search-border-hover focus:outline-none focus:border-search-border-focus" style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search">
                        </div>
        
                        <!-- Mobile search button -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placeholder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="retype-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
    
        <div id="retype-container" class="container relative flex bg-white">
            <!-- Sidebar Skeleton -->
            <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-sidebar-left-bg border-sidebar-left-border sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton">
            
                <div class="flex items-center h-16 px-6">
                    <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-filter-bg border border-filter-border rounded shadow-none text-sm focus:outline-none focus:border-filter-border-focus" type="text" placeholder="Filter">
                </div>
            
                <div class="pl-6 mt-1 mb-4">
                    <div class="w-32 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-48 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-40 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-32 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-48 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-40 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                </div>
            
                <div class="shrink-0 mt-auto bg-transparent dark:border-base-border">
                    <a class="flex items-center justify-center flex-nowrap h-16 text-gray-350 dark:text-dark-400 hover:text-gray-600 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                        <span class="text-xs whitespace-nowrap">Powered by</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                    </a>
                </div>
            </div>
            
            <!-- Sidebar component -->
            <doc-sidebar v-cloak>
                <template #sidebar-footer>
                    <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-base-border">
            
                        <div class="py-3 px-6 md:hidden border-b dark:border-base-border">
                            <nav>
                                <ul class="flex flex-wrap justify-center items-center">
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://adam-bacon.netlify.app/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/>
                                                </g>
                                            </svg>
                                            <span>Old Blog Site</span>
                                        </a>
                                    </li>
            
                                </ul>
                            </nav>
                        </div>
            
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-350 dark:text-dark-400 hover:text-gray-600 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </template>
            </doc-sidebar>
    
            <div class="grow min-w-0 bg-body-bg">
                <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
                <div class="flex">
                    <div id="retype-main" class="min-w-0 p-4 grow md:px-16">
                        <main class="relative pb-12 lg:pt-2">
                            <div class="retype-markdown" id="retype-content">
                                <!-- Rendered if sidebar right is enabled -->
                                <div id="retype-sidebar-right-toggle"></div>
                                <!-- Page content  -->
<doc-anchor-target id="powershell-magic" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#powershell-magic">#</doc-anchor-trigger>
        <span>Powershell Magic <span class="no-link inline-flex align-middle items-center justify-center font-medium leading-none whitespace-nowrap text-badge-warning-text bg-badge-warning border border-badge-warning-border h-6 px-2 text-xs rounded-md">
            <span>Back once again with the Powershell <span class="docs-emoji">&#x1F953;</span> flavour</span>
        </span></span>
    </h1>
</doc-anchor-target>
<div class="-mt-3 mb-12 flex flex-wrap text-sm text-gray-400 dark:text-dark-350 items-center print:justify-center">
    <div class="flex items-center">
        <div>By</div>
        <div class="ml-2 flex items-center">
          <div class="shrink-0 w-8 h-8 overflow-hidden rounded-full">
            <a href="mailto:adambacon1@hotmail.com"><img class="object-cover" src="https://www.gravatar.com/avatar/aa37a353fed4270a1b0c39b827ee1d23?d=mp"></a>
          </div>
          <div class="ml-1 whitespace-nowrap text-gray-500 dark:text-dark-350"><a href="mailto:adambacon1@hotmail.com">Adam Bacon</a></div>
        </div>
    </div>
    <div class="mx-2">&#9679;</div>
    <div class="flex items-center shrink-0">Published&nbsp;<span>2025-09-11</span></div>
</div>

<p><figure class="content-center">
    <img src="../images/ps.png" alt="Powershell is your best friend for automation in my opinion" class="rounded-image-rounded border-image-border border-image-border-width" width="500" />
    <figcaption class="caption">Powershell is your best friend for automation in my opinion</figcaption>
</figure>
</p>
<doc-anchor-target id="what-if">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#what-if">#</doc-anchor-trigger>
        <span>What If</span>
    </h2>
</doc-anchor-target>
<p>This to me, kind of reminds me of certain comic covers from a series Marvel done back in the day. Although I do not read Marvel comics I still loved the idea of a what if scenario, and how it could have completely changed the outcome of the as world we know it today.</p>
<p><figure class="content-center">
    <img src="../images/whatif.png" alt="A Marvel What If comic cover" class="rounded-image-rounded border-image-border border-image-border-width" width="500" />
    <figcaption class="caption">A Marvel What If comic cover</figcaption>
</figure>
</p>
<p>Although we are not here to talk about comics I just wanted to share that nugget of information from me to you.</p>
<p>In this blog I want to cover the <strong>-WhatIf</strong> parameter. As back in the day when I was learning PowerShell I was trying to cram in as much information as my brain could take, and well I guess I misread something or took it too literally that adding <strong>[CmdletBinding()]</strong> at the top of your function would automatically provide the standard parameters to your function such as the below listed parameters:</p>
<ul>
<li><p>-Verbose
Enables detailed output for debugging or informational purposes.</p>
</li>
<li><p>-Debug
Provides debugging information during execution.</p>
</li>
<li><p>-ErrorAction
Specifies how errors are handled (e.g., Stop, Continue, SilentlyContinue, etc.).</p>
</li>
<li><p>-ErrorVariable
Captures error messages into a specified variable.</p>
</li>
<li><p>-WarningAction
Controls how warnings are handled.</p>
</li>
<li><p>-WarningVariable
Captures warning messages into a specified variable.</p>
</li>
<li><p>-OutVariable
Stores output in a specified variable.</p>
</li>
<li><p>-OutBuffer
Specifies the number of objects to buffer before sending them through the pipeline.</p>
</li>
<li><p>-WhatIf
Simulates the execution of the command, showing what would happen without making changes.</p>
</li>
<li><p>-Confirm
Prompts for confirmation before executing an action.</p>
</li>
</ul>
<p>Yeah my bad, I obviously missed something back in the day when I originally read this. Although these standard default parameters are available after adding <strong>[CmdletBinding()]</strong> to get the <strong>Confirm</strong> and <strong>WhatIf</strong> working correctly you do need to do a little extra coding to make this fully work as intended. This is what we are going to cover in this blog, as well as carrying on a little <strong>runspace</strong> magic as an additional parameter set, as the last blog covered runspaces. I thought I could add some extra-spice to the code I am going to share today to hopefully give you some inspiration on things you can do using PowerShell.</p>
<p>Also wanted to emphasize the use of the <strong>-WhatIf</strong> parameter and why you should be using it more in your PowerShell code, especially if you are modifying anything with <strong>Add-,New-,Remove-,Set-</strong> named cmdlets. As these are implementing a change, and wouldn&#x27;t it be nice to know what will change before actually doing the change. As this could prevent you making a big mistake accidentally applying a change to the wrong item.</p>
<doc-anchor-target id="cmdlet-naming">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cmdlet-naming">#</doc-anchor-trigger>
        <span>Cmdlet Naming</span>
    </h2>
</doc-anchor-target>
<p>Again another gotcha for me when learning PowerShell a long time ago, was thinking why is everything in singular on the cmdlet namings. Having used PowerShell for like over 15 years, I get why it was done like this as you are dealing with objects and for instance the cmdlet <strong>Remove-Item</strong> is just built to do exactly what it says, just to remove one item. Yes you could <strong>Get-ChildItem</strong> of a directory to get all the files in that directory, then pipeline this to a <strong>Foreach-Object</strong> then remove all of those files in that directory. However this needs you as the end-user to have a bit of knowledge on pipelining one cmdlet to another. So this got me thinking <strong>What if the Powershell Team used plurals instead of singular cmdlet naming</strong></p>
<p><figure class="content-center">
    <img src="../images/comic_cover.png" alt="If only this comic was made, how awesome would that have been" class="rounded-image-rounded border-image-border border-image-border-width" width="500" />
    <figcaption class="caption">If only this comic was made, how awesome would that have been</figcaption>
</figure>
</p>
<p>I know this would not have as big of an impact as some of the What If comics out there, but it might have made sense for more people like myself when I was learning PowerShell many years ago.</p>
<p>So I will turn that idea into reality by creating a new function to act as a standard cmdlet but I will use the plural naming convention. Today folks we will cover <strong>Remove-Items</strong> a brand new advanced function I made especially for this blog, and implementing the <strong>-WhatIf</strong> parameter to run inside this function. To make this function more powerful and more like a true PowerShell cmdlet, we will add different parameter sets to enable the function to be run using traditional single thread approach, or having the ability to run the same function but using different parameters to enable the mighty runspaces feature to allow the end result to be processed a lot faster. However I did face a small PowerShell gotcha obstacle to overcome first</p>
<doc-anchor-target id="planning">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#planning">#</doc-anchor-trigger>
        <span>Planning</span>
    </h2>
</doc-anchor-target>
<p>In my personal opinion it is better to plan your functions before writing them, as you could possibly write the function then think damn, what if I had of included that capability or added this parameter, but the code is done already and your co-workers might be like kids in the back of a car, &quot;Are we nearly there yet?&quot; that pressure might then lead you to release the code into production without it being the best it could be.</p>
<p>I do try an follow PowerShell best practices as this does make your code better, but maybe next time before just blindly writing out code, think about all the things you want your function to do and the parameters you will need, and maybe another whole set of parameters to use to have multiple parameter sets for the end-user to run depending on their scenario.</p>
<p>Let us start small then increase the code as we go to fully understand implementing the <strong>-WhatIf</strong> into your functions. So lets drill it into our brains what we need to include as a minimum to get the <strong>-WhatIf</strong> working</p>
<div class="codeblock-wrapper"><doc-codeblock line-numbers>
<pre translate="no" class="language-powershell"><code v-pre class="language-powershell">function Get-CurrentDate {
    [CmdletBinding(SupportsShouldProcess = $true, ConfirmImpact = 'Low')]
    param ()

    if ($PSCmdlet.ShouldProcess(&quot;System Clock&quot;, &quot;Retrieve current date&quot;)) {
        $currentDate = Get-Date
        Write-Output &quot;Current date is: $currentDate&quot;
    } else {
        Write-Output &quot;WhatIf: Retrieving current date would return the current system date. As in $(Get-Date).&quot;
    }
}</code></pre>
</doc-codeblock></div>
<p>So step one is we need to include something additional information inside the normal <strong>[CmdletBinding()]</strong> which gives the standard parameters in your function like discussed in the bullet points earlier. To include the <strong>-WhatIf</strong> and make it work, we need to add the following within the <strong>[CmdletBinding()]</strong> to <strong>[CmdletBinding(SupportsShouldProcess = $true)]</strong> which will let PowerShell know we want to support the <strong>-WhatIf</strong> and <strong>-Confirm</strong> parameters, I ended up adding <strong>ConfirmImpact = &#x27;Low&#x27;</strong> but,  <strong>this is not required, to have this function supporting WhatIf and Confirm</strong> I just figured as a best practise to include this, and will explain in a bit why.</p>
<p>Next we need to determine if the <strong>-WhatIf</strong> parameter has actually been passed in by the user running the function. So to do this bit of magic we can use a simple <strong>if / else</strong> block to determine if it was passed or not. The <strong>IF</strong> code runs if <strong>-WhatIf was not passed</strong> but we still need to explain what will happen on the target aka the computer clock in this case, and the action it will take using this code <strong>$PSCmdlet.ShouldProcess(&quot;System Clock&quot;, &quot;Retrieve current date&quot;)</strong> so with this bit of code we are saying, this is what the function would do if we ran this command without a whatif. As in the target we are going to deal with is the <strong>System Clock</strong> and the action that will be taken <strong>Retrieve the current date</strong></p>
<p>It might seem confusing on the else block of the code running when the <strong>-Whatif</strong> parameter was passed. The reason why it doesnt run in the if statement of the code is due to <strong>$PSCmdlet.ShouldProcess</strong> will be <strong>$true</strong> if <strong>-Whatif was not used</strong> thus making <strong>$PSCmdlet.ShouldProcess to $false</strong> if the user did supply the <strong>-Whatif</strong> parameter.</p>
<p>As a bonus as it stands this function also supports the <strong>-Confirm</strong> parameter if supplied to confirm you want to actually run the function. In the script I share in a moment, you will notice an extra few things nested within <strong>[CmdletBinding()]</strong> which is the <strong>DefaultParameterSetName</strong> as I have the ability to call the function using either one parameter set or another parameter set, and specify the name of your parameter set you want to make the default one is why you would include this. Also as the function I am about to share, will change something on the system as in delete files, I have set the <strong>ConfirmImpact</strong> to high to reflect this, as the default <strong>$ConfirmPreference</strong> is set to high by default, so the end user will be prompted to confirm the action about to happen even if they did not specify <strong>-Confirm</strong></p>
<p>Due to this function only reading the current date and not modifying anything, I have reflected that with <strong>ConfirmImpact = Low</strong> so unless the <strong>-Confirm</strong> parameter is passed to the function it will not prompt you for confirmation, but we could have left this out entirely, and the <strong>-Confirm</strong> parameter would have still worked, but just thinking about making it more understandable, and following best practises.  This is why you would use the <strong>ConfirmImpact</strong> within the <strong>CmdletBinding</strong> to specify the impact it could have on the system, and if it is automatically prompting you to confirm or not when running.</p>
<p>Take the function just listed <strong>Get-CurrentDate</strong> as a core building block to implementing <strong>-WhatIf</strong> and <strong>-Confirm</strong> parameters like a double whammy into your functions for that extra bit of spicy ricey flavour.  Making your function behave more like an official PowerShell cmdlet.</p>
<p>As mentioned think about the parameters you will want to be available to your end-user running a function you design. If you maybe include too many parameters then break those down into specific parameter sets, or if you only want parameters x and y to be availble running it one way, and parameter z as the only choice if the function is to be run another way.  Parameter sets within functions allow the end user to use your function using parameter A set, or parameter B set and maybe even parameter C set depending on the amount of parameters you have, and if you only want parameters to be available in a certain way when running the function.  In the code I am about to share, I wanted the ability to either remove files using a single thread or multiple run-spaces to make it a bit like pressing that nitro button you wish you had in your car.</p>
<p>Please look at the synopsis it is following best practises to include these in your functions or scripts to give the end user an idea about what the code will do, and examples of using the function.  I have added comments within the code to explain little bits of code at a time, but the main thing about this for me was implementing the <strong>-WhatIf</strong> parameter in either parameter set passed.</p>
<doc-anchor-target id="note-to-self">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#note-to-self">#</doc-anchor-trigger>
        <span>Note to self</span>
    </h2>
</doc-anchor-target>
<div class="flex mb-6">
    <div class="shrink-0 w-1.5 rounded-tl-lg rounded-bl-lg bg-callout-primary"></div>
    <div class="flex w-full py-4 border border-l-0 rounded-tr-lg rounded-br-lg doc-callout bg-callout-base-bg border-callout-base-border" role="alert">
        <div class="flex items-center ml-4 h-7">
            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px text-callout-primary" width="22" height="22" viewBox="0 0 24 24" role="presentation">
                <g fill="currentColor"><g>
                    <path d="M12 1C5.93 1 1 5.93 1 12s4.93 11 11 11 11-4.93 11-11S18.07 1 12 1zm0 20c-4.96 0-9-4.04-9-9s4.04-9 9-9 9 4.04 9 9-4.04 9-9 9z"></path>
                    <path d="M12 11c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1s1-.45 1-1v-4c0-.55-.45-1-1-1zM12.01 7c-.56 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"></path>
                    <path fill="none" d="M0 0h24v24H0z"></path>
                </g></g>
            </svg>
        </div>
        <div class="pr-5 ml-3 w-full">
<p>PowerShell runspaces do not natively support the -WhatIf parameter. The -WhatIf parameter is a feature of cmdlets and advanced functions that implement the ShouldProcess method. Runspaces, on the other hand, are a lower-level construct used for running PowerShell code in parallel or asynchronously, and they do not inherently understand or process -WhatIf.</p>
<p>However, you can design the scripts or cmdlets executed within a runspace to support -WhatIf by implementing ShouldProcess in those scripts or cmdlets. This way, the logic for -WhatIf is handled within the code being executed, not by the runspace itself.</p>
<p>If you need to simulate -WhatIf behavior in a runspace, you would need to explicitly pass the -WhatIf parameter to the cmdlets or functions being executed within the runspace, assuming they support it.</p>
        </div>
    </div>
</div>
<doc-anchor-target id="remove-items">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#remove-items">#</doc-anchor-trigger>
        <span>Remove-Items</span>
    </h2>
</doc-anchor-target>
<p>The moment you have all been waiting for, the code section. Originally I was just going to make this a lot more simple. However I thought the code would not live up to the PowerShell language if it was not super powerful. So I thought about things that could go wrong when using this function, like the directory path specified not existing, if no files were returned in the directory specified then there would be nothing to remove. Giving the ability to filter on particular file-types, which could then be more useful to the end user if a particular directory keeps filling up with say *.LOG files, then you got the ability to delete all those files using the one cmdlet instead of piping the output to another cmdlet to do the work. I then thought about the stupid amount of times you get the windows timer showing you the progress of deletions when deleting large amounts of files via the GUI, and wouldn&#x27;t it be super powerful to make that super fast by using runspaces to process the deletions in batches to make it quicker. Finally wanted to make sure that the <strong>-WhatIf</strong> parameter really did work in both the different parameter sets defined within the function. I did use this function last night when testing it, and damn this removed things quicker than the time it takes to blink your eyes, it really is that fast.</p>
<div class="flex mb-6">
    <div class="shrink-0 w-1.5 rounded-tl-lg rounded-bl-lg bg-callout-primary"></div>
    <div class="flex w-full py-4 border border-l-0 rounded-tr-lg rounded-br-lg doc-callout bg-callout-base-bg border-callout-base-border" role="alert">
        <div class="flex items-center ml-4 h-7">
            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px text-callout-primary" width="22" height="22" viewBox="0 0 24 24" role="presentation">
                <g fill="currentColor"><g>
                    <path d="M12 1C5.93 1 1 5.93 1 12s4.93 11 11 11 11-4.93 11-11S18.07 1 12 1zm0 20c-4.96 0-9-4.04-9-9s4.04-9 9-9 9 4.04 9 9-4.04 9-9 9z"></path>
                    <path d="M12 11c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1s1-.45 1-1v-4c0-.55-.45-1-1-1zM12.01 7c-.56 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"></path>
                    <path fill="none" d="M0 0h24v24H0z"></path>
                </g></g>
            </svg>
        </div>
        <div class="pr-5 ml-3 w-full">
<p>Disclaimer: I want you to understand that this is removing files. So please do not go off and try this on a mission critical server, then send bad karma my way, please test on a personal device deleting none important files first, and using the -WhatIf parameter to make sure you 100% understand how to use this and the consequences of using it.  Thank you.</p>
        </div>
    </div>
</div>
<div class="codeblock-wrapper"><doc-codeblock line-numbers>
<pre translate="no" class="language-powershell"><code v-pre class="language-powershell">&lt;#
.SYNOPSIS
Removes files from a specified directory, optionally using parallel processing.

.DESCRIPTION
The Remove-Items function deletes files from a given directory path, with support for filtering file names and recursive search. It can operate in standard mode or parallel mode, allowing for faster deletion of large numbers of files using runspaces. The function supports WhatIf and Confirm prompts for safe operation. Although Confirm is redundant when using parallel mode.

.PARAMETER Path
The path to the directory containing files to remove. Must be an existing directory.

.PARAMETER Filter
A filter string to select files for removal. Defaults to '*' (all files).

.PARAMETER Throttle
Specifies the maximum number of parallel runspaces to use when running in parallel mode. Valid values are 1 to 20.

.PARAMETER MinRunspaces
Specifies the minimum number of runspaces to use in parallel mode. Valid values are 1 to 9.

.EXAMPLE
Remove-Items -Path &quot;C:\Temp&quot; -Filter &quot;*.log&quot;
Removes all .log files from C:\Temp and its subdirectories.

.EXAMPLE
Remove-Items -Path &quot;C:\Temp&quot; -Filter &quot;*.tmp&quot; -Throttle 5 -MinRunspaces 2
Removes all .tmp files from C:\Temp using parallel processing with up to 5 runspaces.

.NOTES
- Supports ShouldProcess for WhatIf and Confirm.
- Parallel mode is activated by specifying Throttle or MinRunspaces parameters.
- Verbose output is available for removed files.
- Handles errors gracefully and provides warnings for failures.
#&gt;

function Remove-Items {
    [CmdletBinding(DefaultParameterSetName = 'Standard', SupportsShouldProcess = $true, ConfirmImpact = 'High')]
    param (
        # Path to the directory
        [Parameter(Mandatory = $true)]
        [string]$Path,
        # File filter (wildcard pattern)
        [string]$Filter = '*',
        # Maximum number of concurrent runspaces
        [Parameter(ParameterSetName = 'Parallel')]
        [ValidateRange(1, 20)]
        [int]$Throttle = 10,
        # Minimum number of runspaces to use
        [Parameter(ParameterSetName = 'Parallel')]
        [ValidateRange(1, 9)]
        [int]$MinRunspaces = 1
    )
    # Validate path to ensure it exists
    if (-not (Test-Path -Path $Path -PathType Container)) {
        Write-Warning &quot;The specified path does not exist or is not a directory: $Path&quot;
        return
    }
    # Get files to remove
    $files = Get-ChildItem -Path $Path -Filter $Filter -File -Recurse
    #  Standard removal
    if ($PSCmdlet.ParameterSetName -eq 'Standard') {
        foreach ($file in $files) {
            if ($PSCmdlet.ShouldProcess($file.FullName, &quot;Remove file&quot;)) {
                try {
                    Remove-Item -Path $file.FullName -Force -ErrorAction Stop
                    Write-Verbose &quot;Removed: $($file.FullName)&quot;
                } catch {
                    Write-Warning &quot;Failed to remove '$($file.FullName)': $($_.Exception.Message)&quot;
                }
            }
        }
    }
    # Parallel removal
    else {
        $VerbosePreferenceValue = $VerbosePreference
        # Create runspace pool
        $runspacePool = [RunspaceFactory]::CreateRunspacePool($MinRunspaces, $Throttle)
        $runspacePool.Open()
        # Batch files to limit number of runspaces
        $batchSize = [Math]::Ceiling($files.Count / $Throttle)
        $fileBatches = @()
        if ($files.Count -gt 0) {
            for ($i = 0; $i -lt $files.Count; $i += $batchSize) {
                $fileBatches += ,$files[$i..([Math]::Min($i + $batchSize - 1, $files.Count - 1))]
            }
        }
        # Start runspaces
        $runspaces = foreach ($batch in $fileBatches) {
            $powershell = [PowerShell]::Create()
            $powershell.RunspacePool = $runspacePool
            $Simulate = $WhatIfPreference
            $null = $powershell.AddScript({
                param($filePaths, $verbosePreferenceValue, $simulate)
                $VerbosePreference = $verbosePreferenceValue
                $results = @()
                foreach ($filePath in $filePaths) {
                    if ($simulate) {
                        $results += &quot;WhatIf: Would remove $filePath&quot;
                    } else {
                        try {
                            Remove-Item -Path $filePath -Force -ErrorAction Stop
                            $results += &quot;Removed: $filePath&quot;
                        } catch {
                            $results += &quot;Failed to remove '$filePath': $($_.Exception.Message)&quot;
                        }
                    }
                }
                return $results
            }).AddArgument($batch.FullName).AddArgument($VerbosePreferenceValue).AddArgument($Simulate)
            # Create custom object to track runspace and its status
            [PSCustomObject]@{
                Pipe   = $powershell
                Status = $powershell.BeginInvoke()
            }
        }
        # Wait for all runspaces to complete
        foreach ($rs in $runspaces) {
            try {
                $output = $rs.Pipe.EndInvoke($rs.Status)
                foreach ($line in $output) {
                    Write-Host $line
                }
            } catch {
                Write-Warning &quot;Runspace error: $($_.Exception.Message)&quot;
            } finally {
                if ($null -ne $rs.Pipe) {
                    $rs.Pipe.Dispose()
                }
            }
        }
        # Clean up runspace pool
        $runspacePool.Close()
        $runspacePool.Dispose()
    }
}</code></pre>
</doc-codeblock></div>
<p>Boom there you have it, how to implement the <strong>-WhatIf</strong> parameter in a traditional approach, and implementing it to support runspaces which as mentioned is not supported by default.  I hope this blog has been insightful for you, and hopefully you made it through reading it without being left with lots more questions in your head, or just thinking what the flip...I write these blogs to help others and share information on using PowerShell to complete things automatically instead of being a point and click person to fix something.</p>
<doc-anchor-target id="something-to-share">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#something-to-share">#</doc-anchor-trigger>
        <span>Something to share</span>
    </h2>
</doc-anchor-target>
<p>Been loving the retro synth vibe lately, and spent the evening making this tune a few nights back.  This is a complete tune and was really happy with how it sounded so was worth the time in my opinion spending an evening doing it. I hope you enjoy this music too <span class="docs-emoji">&#x1F3B5;</span></p>
<div class="aspect-video w-full rounded-lg overflow-hidden mb-6 shadow-lg dark:shadow-lg">
    <iframe src="https://www.youtube.com/embed/sthPIxkYukE" frameborder="0" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen class="w-full h-full"></iframe>
</div>
<p>Until the next blog stay safe, and see you again soon.</p>

                                
                                <!-- Required only on API pages -->
                                <doc-toolbar-member-filter-no-results></doc-toolbar-member-filter-no-results>
                            </div>
                            <footer id="retype-content-footer" class="clear-both">
                            
                                <nav id="retype-nextprev" class="print:hidden flex mt-14">
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 h-full flex items-center break-normal font-medium text-body-link border border-base-border hover:border-base-border-hover rounded-l-lg transition-colors duration-150 relative hover:z-5" href="../runspaces/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                            <span>
                                                <span class="block text-xs font-normal text-base-text-muted">Previous</span>
                                                <span class="block mt-1">Runspaces</span>
                                            </span>
                                        </a>
                                    </div>
                            
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-body-link border border-base-border hover:border-base-border-hover rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../aiassistant/">
                                            <span>
                                                <span class="block text-xs font-normal text-right text-base-text-muted">Next</span>
                                                <span class="block mt-1">AI Assistant</span>
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        </a>
                                    </div>
                                </nav>
                            </footer>
                        </main>
                
                        <div id="retype-page-footer" class="print:border-none border-t border-base-border pt-6 mb-8">
                            <footer class="flex flex-wrap items-center justify-between print:justify-center">
                                <div id="retype-footer-links" class="print:hidden">
                                    <ul class="flex flex-wrap items-center text-sm">
                                    </ul>
                                </div>
                                <div id="retype-copyright" class="print:justify-center py-2 text-footer-text font-footer-link-weight text-sm leading-relaxed"><p>© Copyright 2025. All rights reserved.</p></div>
                            </footer>
                        </div>
                    </div>
                
                    <!-- Rendered if sidebar right is enabled -->
                    <!-- Sidebar right skeleton-->
                    <div v-cloak class="fixed top-0 bottom-0 right-0 translate-x-full bg-sidebar-right-bg border-sidebar-right-border lg:sticky lg:border-l lg:shrink-0 lg:pt-6 lg:transform-none sm:w-1/2 lg:w-64 lg:z-0 md:w-104 sidebar-right skeleton">
                        <div class="pl-5">
                            <div class="w-32 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                            <div class="w-48 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                            <div class="w-40 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                        </div>
                    </div>
                
                    <!-- User should be able to hide sidebar right -->
                    <doc-sidebar-right v-cloak></doc-sidebar-right>
                </div>

            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="retype-overlay-target"></div>

    <script data-cfasync="false">window.__DOCS__ = { "title": "WhatIf", level: 1, icon: "file", hasPrism: true, hasMermaid: false, hasMath: false, tocDepth: 23 }</script>
</body>
</html>
